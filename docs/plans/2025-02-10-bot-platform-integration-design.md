# CC QwQ Bot 平台集成设计文档

**日期**: 2025-02-10
**版本**: 1.0
**状态**: 设计完成，待实施

---

## 1. 概述

### 1.1 目标

将 CC QwQ 从"专用移动端 App"方案改造为"基于 WhatsApp + 飞书"的 Bot 方案，用户可以通过日常聊天应用远程控制 Claude Code。

### 1.2 核心设计原则

- **保留优先**：尽可能复用现有代码，Bot 只是另一种"客户端"
- **适配器模式**：WhatsApp 和飞书通过统一接口接入
- **混合模式**：简单操作在聊天中，复杂操作引导到桌面端
- **状态同步**：聊天和桌面端状态保持一致

---

## 2. 系统架构

### 2.1 整体架构

```
┌──────────────┐     ┌──────────────┐
│ WhatsApp Bot │     │  飞书 Bot    │
└──────┬───────┘     └──────┬───────┘
       │                    │
       └────────┬───────────┘
                ↓
┌───────────────────────────────────────────────┐
│           Desktop App (Electron)             │
│  ┌─────────────────────────────────────────┐ │
│  │   Bot Middleware Layer (新增)          │ │
│  └─────────────────────────────────────────┘ │
│  ┌─────────────────────────────────────────┐ │
│  │   Existing Layer (保留)               │ │
│  └─────────────────────────────────────────┘ │
│  ┌─────────────────────────────────────────┐ │
│  │   UI Layer (保留)                      │ │
│  └─────────────────────────────────────────┘ │
└───────────────────┬───────────────────────────┘
                    ↓
┌───────────────────────────────────────────────┐
│            Claude Code CLI                    │
└───────────────────────────────────────────────┘
```

### 2.2 技术栈

| 组件 | 技术选型 |
|-----|---------|
| WhatsApp | whatsapp-web.js |
| 飞书 | @larksuiteoapi/node-sdk |
| 桌面端 | Electron + React 19 (保留) |
| 备用方案 | Expo + React Native (保留) |

---

## 3. 消息与命令系统

### 3.1 命令分类

**对话消息**: 转发给 Claude Code
- 普通提问
- 代码修改请求

**系统命令**: Bot 中间件处理
- `/status` - 查看状态
- `/switch <id>` - 切换对话
- `/history` - 查看历史
- `/file <path>` - 读取文件
- `/help` - 帮助

**操作命令**:
- `/approve` - 批准权限
- `/deny` - 拒绝权限
- `/trust` - 信任文件夹
- `/switch-model <model>` - 切换模型

---

## 4. 实施路线图

### Phase 1: 基础设施（2-3 周）
- [ ] Bot 层架构
- [ ] WhatsApp 集成
- [ ] 飞书集成
- [ ] 配置 UI

### Phase 2: 核心功能（3-4 周）
- [ ] Claude Code 集成
- [ ] 消息转发
- [ ] 命令系统
- [ ] 状态同步

### Phase 3: 高级功能（2-3 周）
- [ ] 权限管理
- [ ] 技能/MCP 控制
- [ ] 文件操作

### Phase 4: 测试优化（1-2 周）
- [ ] 测试
- [ ] 文档
- [ ] Release

**预计工期**: 8-11 周

---

## 5. 风险与缓解

| 风险 | 缓解措施 |
|-----|---------|
| whatsapp-web.js 被封 | 保留 Expo 备用 |
| 飞书 API 变更 | 版本锁定 + 监控 |

---

**文档版本**: 1.0
**最后更新**: 2025-02-10
